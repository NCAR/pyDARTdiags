
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Observation Sequences &#8212; pyDARTdiags</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'userguide/working-with-obsq';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Statistics" href="statistics.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">WARNING: pyDARTdiags is currently in alpha stage of development - expect bugs and changes</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">pyDARTdiags</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../devel/index.html">
    Developer Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/NCAR/pyDARTdiags/releases">
    Release Notes
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/NCAR/pyDARTdiags" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../devel/index.html">
    Developer Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/NCAR/pyDARTdiags/releases">
    Release Notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/NCAR/pyDARTdiags" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installguide.html">Install Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Observation Sequences</a></li>
<li class="toctree-l1"><a class="reference internal" href="statistics.html">Statistics</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Observation Sequences</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="observation-sequences">
<span id="working-with-obsq"></span><h1>Observation Sequences<a class="headerlink" href="#observation-sequences" title="Link to this heading">#</a></h1>
<p>DART uses observation sequence files to store observations and their associated
metadata. These files are used as input/output for the DART assimilation system.</p>
<p>There are three types of observation sequence file:</p>
<ul class="simple">
<li><p><strong>obs_seq.in</strong>: A ‘blank’ observation sequence file which contains the locations of observations and their
associated metadata, but no observation values. Typically this file is used as input for creating synthetic observations
for a perfect-model or Observation System Simulation Experiment (OSSE) experiment.</p></li>
<li><p><strong>obs_seq.out</strong>: A observation sequence file which contains observations and their associated metadata. This
is used as input to filter, the DART assimilation program.</p></li>
<li><p><strong>obs_seq.final</strong>: A observation sequence file which contains the observations and their
associated metadata after assimilation. This file is created by filter, the DART assimilation program.
The assimilation data is the mean and spread of the forward operator for
each observation, and optionally each ensemble members value of the forward operator.
For detail on how the assimilation statistics are calculated, see the
<a class="reference internal" href="statistics.html#statistics"><span class="std std-ref">Statistics</span></a> section of the user guide.
The prior assimilation data is always present in the observation sequence file after
assimilation, the posterior assimilation data is only present if the user chooses to do
posterior forward operator calculations.</p></li>
</ul>
<p>Observation sequence files have a header, followed by a linked list of observations ordered in time.
Here is an example of the header of an observation sequence file, an obs_seq.out the
World Ocean Database (WOD) observations:</p>
<pre style="background-color: #f8f8f8; color: #000000;"><code>
   obs_sequence
 obs_type_definitions
           <span style="color: red;">13</span>
           15 FLOAT_SALINITY
           16 FLOAT_TEMPERATURE
           23 GLIDER_SALINITY
           24 GLIDER_TEMPERATURE
           27 MOORING_SALINITY
           28 MOORING_TEMPERATURE
           32 CTD_SALINITY
           33 CTD_TEMPERATURE
           38 XCTD_SALINITY
           39 XCTD_TEMPERATURE
           43 XBT_TEMPERATURE
           46 APB_SALINITY
           47 APB_TEMPERATURE
   num_copies:            1  num_qc:            1
   num_obs:        48982  max_num_obs:        48982
 <span style="color: blue;">WOD observation</span>
 <span style="color: green;">WOD QC</span>
   first:            1  last:        48982
 </code></pre><p>The header starts with the keyword <cite>obs_sequence</cite>, then the keyword <cite>obs_type_definitions</cite>
then on the next line, a number indicating the number of different types (kinds) of
observations in the file. In this header there are  <span style="color: red;">13</span> observation types defined.
The list of observation type follows, each observation type is defined by a unique integer.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The type integers are only unique within the file, not across files. The parameter, e.g.
“FLOAT_SALINITY” is what is used internally in DART to refer to this observation type.</p>
</div>
<p>After the list of observation types, there are the number of copies <cite>num_copies</cite>,
number of quality control copies <cite>num_qc</cite>, number of observations <cite>num_obs</cite>, and maximum
number of observations, <cite>max_num_obs</cite>.</p>
<p>The names of the copies are listed one per line, the copies followed by the qc copies.
The order of these copies is the same for each observation. In this example, there is one copy
<span style="color: blue;">WOD observation</span> and one quality control copy, <span style="color: green;">WOD QC</span>.
Each observation in the observation sequence has all the copies listed in the header.</p>
<p>The last line of the header contains the first and last observation numbers. This is used to
indicate the start and end of the linked list of observations in the file. In this example,
the first observation is OBS 1 and the last observation is OBS 48982. Note that because the sequence
is a linked list the order of observations in the file is not not necessarily the same as the order of the
observations in time.</p>
<p>A header for an obs_seq.final file is similar, but it will also include the assimilation information
for each observation, such as the prior and posterior forward operator mean and spread, and DART_QC.</p>
<pre style="background-color: #f8f8f8; color: #000000;"><code>
   obs_sequence
 obs_type_definitions
             <span style="color: red;">13</span>
               15 FLOAT_SALINITY
               16 FLOAT_TEMPERATURE
               23 GLIDER_SALINITY
               24 GLIDER_TEMPERATURE
               27 MOORING_SALINITY
               28 MOORING_TEMPERATURE
               32 CTD_SALINITY
               33 CTD_TEMPERATURE
               38 XCTD_SALINITY
               39 XCTD_TEMPERATURE
               43 XBT_TEMPERATURE
               46 APB_SALINITY
               47 APB_TEMPERATURE
   num_copies:           11  num_qc:            2
   num_obs:        48982  max_num_obs:        48982
 <span style="color: blue;">WOD observation</span>
 prior ensemble mean
 posterior ensemble mean
 prior ensemble spread
 posterior ensemble spread
 prior ensemble member      1
 posterior ensemble member      1
 prior ensemble member      2
 posterior ensemble member      2
 prior ensemble member      3
 posterior ensemble member      3
 <span style="color: green;">WOD QC</span>
 DART quality control
   first:            1  last:        48982
 </code></pre><p>Here is the format of the obs_seq.out observation sequence file after the header,
showing the first two observations:</p>
<pre style="background-color: #f8f8f8; color: #000000;"><code>
 OBS            1
   <span style="color: blue;">26.0720005035400</span>
   <span style="color: green;">0.000000000000000E+000</span>
           -1           2          -1
 obdef
 loc3d
     3.692663001096695        0.2111673857993198         0.000000000000000      3
 kind
           16
 <span style="color: orange;">43560     151935</span>
   0.250000000000000
 OBS            2
   <span style="color: blue;">3.379800033569336E-002</span>
   <span style="color: green;">0.000000000000000E+000</span>
           1           3          -1
 obdef
 loc3d
     3.692663001096695        0.2111673857993198         0.000000000000000      3
 kind
           15
 <span style="color: orange;">43560     151935</span>
   2.500000000000000E-007
</code></pre><p>Each observation in the sequence starts with the keyword <cite>OBS</cite>, followed by the observation number
on the same line.  The copies for each observation are listed on the next lines, following
the pattern of the header. In this example, the first copy is the
<span style="color: blue;">WOD observation</span> and second copy is <span style="color: green;">WOD QC</span>. Each observation has all
the copies listed in the header.
In obs_seq.out files the copies are typically the observation value and the quality control values.
In obs_seq.final files, there will be additional copies for the prior and (optionally) posterior
forward operator mean and spread, and optionally the prior and posterior forward operator values
for each ensemble member.</p>
<p>The line after the copies is the linked list information, which contains the previous observation number,
the next observation number, a third number (-1) which is reserved for use in DART.</p>
<p>The keyword <cite>obdef</cite> indicates the start of the observation definition.</p>
<p>The next line, in this example, <cite>loc3d</cite> indicates a 3D or 1D location.
For 3D observations the observation’s longitude, latitude in radians, and the vertical value and
vertical coordinate (e.g. meters, pressure) is next. For 1D, location is a single number.
The keyword <cite>kind</cite> indicates the type of observation, which is an integer that corresponds to the
observation type (kind) defined in the header.  In this example, observation number 1 is a 16, which is
a FLOAT_TEMPERATURE observation, and observation number 2 is 15 which is a FLOAT_SALINITY observation.
Any additional metadata for the observation is stored after the type, for example a satellite observations may have
channel, platform, and sensor information. In this example, there is no extra metadata.</p>
<p>The next line is observation time in <span style="color: orange;"> seconds</span>, <span style="color: orange;"> days</span> since a reference time (usually 1601 01 01 00:00:00 for DART),
the last line of the observation is the observation error variance.</p>
<section id="working-with-observation-sequence-objects">
<h2>Working with Observation Sequence Objects<a class="headerlink" href="#working-with-observation-sequence-objects" title="Link to this heading">#</a></h2>
<p>PyDARTdiags enables you to interact with DART observation sequence files
using Python and <a class="reference external" href="https://pandas.pydata.org/">Pandas</a> - the Python Data Analysis Library.
You read the observation sequence file into a ObsSequence object, which contains all the
information about the observation sequence together with a Pandas DataFrame containing the data for
all the observations in the sequence.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pydartdiags.obs_sequence.obs_sequence</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">obsq</span>
<span class="n">obs_seq</span> <span class="o">=</span> <span class="n">obsq</span><span class="o">.</span><span class="n">ObsSequence</span><span class="p">(</span><span class="s1">&#39;obs_seq.final&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can then examine, change, and visualize the observation sequence data,
and write out new observation sequence files.  In this example our observation sequence file
<code class="docutils literal notranslate"><span class="pre">obs_seq.final</span></code> has been read into <code class="docutils literal notranslate"><span class="pre">obs_seq</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">obs_seq</span></code> is the ObsSequence object.</p>
<p>You can think of the ObsSequence object a container for the observation sequence,
which includes the header information and the observation data. The ObsSequence object has attributes
that correspond to the header information, such as the number of observations, the observation types,
and the observation copies. You can access these attributes using the dot notation, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">obs_seq</span><span class="o">.</span><span class="n">copie_names</span><span class="p">)</span> <span class="c1"># print the names of the observation copies</span>
</pre></div>
</div>
<p>For the example above, gives:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[&#39;WOD observation&#39;, &#39;WOD QC&#39;]
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">obs_seq.df</span></code> is the DataFrame containing all the observations.</p>
<p>There are various modules in PyDARTdiags that are used to work with obs_sequence objects:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/obs_sequence.html#module-obs_sequence" title="obs_sequence"><code class="xref py py-mod docutils literal notranslate"><span class="pre">obs_sequence</span></code></a> - contains the ObsSequence class, which is used to read and write observation sequence files.</p></li>
<li><p><a class="reference internal" href="../api/stats.html#module-0" title="stats"><code class="xref py py-mod docutils literal notranslate"><span class="pre">stats</span></code></a> - contains functions to calculate statistics on the observation sequence data.</p></li>
<li><p><a class="reference internal" href="../api/matplots.html#module-0" title="matplots"><code class="xref py py-mod docutils literal notranslate"><span class="pre">matplots</span></code></a> - contains functions to plot the observation sequence data using
<a class="reference external" href="https://matplotlib.org/">Matplotlib</a>, to produce similar output to the DART
<a class="reference external" href="https://docs.dart.ucar.edu/en/latest/guide/matlab-observation-space.html">Matlab diagnostics</a> .</p></li>
<li><p><a class="reference internal" href="../api/plots.html#module-0" title="plots"><code class="xref py py-mod docutils literal notranslate"><span class="pre">plots</span></code></a> - contains functions to plot the observation sequence data using
<a class="reference external" href="https://plotly.com/">Plotly</a> to produce interactive plots</p></li>
</ul>
<p>In addition, you can edit the observation sequence data directly using the Pandas DataFrame methods.
You can use the Pandas DataFrame methods to filter, group, and aggregate the observation sequence data.
For example, you can filter the observation sequence data to only include observations of a certain type,
or filter by region by masking out lon-lat, or time period, or remove columns that you do not need.
There are examples of editing observation sequences in the <a class="reference internal" href="../examples/01_manipulating/index.html#manip-examples-index"><span class="std std-ref">Manipulating Observation Sequences</span></a> gallery.</p>
<p>To write your modified observation sequence data back to a file, you can use the
<a class="reference internal" href="../api/obs_sequence.html#obs_sequence.ObsSequence.write_obs_seq" title="obs_sequence.ObsSequence.write_obs_seq"><code class="xref py py-func docutils literal notranslate"><span class="pre">obs_sequence.ObsSequence.write_obs_seq()</span></code></a> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">obs_seq</span><span class="o">.</span><span class="n">write_obs_seq</span><span class="p">(</span><span class="s1">&#39;modified_obs_seq.out&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The write_obs_seq method will update the attributes of the ObsSequence object. It updates the header
with the number of observations, converts coordinates back to radians if necessary,
sorts the DataFrame by time, and generates a linked list pattern for reading by DART programs.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>pyDARTdiags sorts by time and then creates a linked list pattern for reading by DART programs.
The linked list is not used by pyDARTdiags, but is required for DART programs to read the observation sequence file.
Do not edit the linked list column in the DataFrame as it will be overwritten when you call
<a class="reference internal" href="../api/obs_sequence.html#obs_sequence.ObsSequence.write_obs_seq" title="obs_sequence.ObsSequence.write_obs_seq"><code class="xref py py-func docutils literal notranslate"><span class="pre">obs_sequence.ObsSequence.write_obs_seq()</span></code></a> or <a class="reference internal" href="../api/obs_sequence.html#obs_sequence.ObsSequence.update_attributes_from_df" title="obs_sequence.ObsSequence.update_attributes_from_df"><code class="xref py py-func docutils literal notranslate"><span class="pre">obs_sequence.ObsSequence.update_attributes_from_df()</span></code></a></p>
</div>
<p>You may want to synchronize the ObsSequence attributes with the DataFrame after making changes to the DataFrame
without calling write_obs_seq. You can do this by calling the <a class="reference internal" href="../api/obs_sequence.html#obs_sequence.ObsSequence.update_attributes_from_df" title="obs_sequence.ObsSequence.update_attributes_from_df"><code class="xref py py-func docutils literal notranslate"><span class="pre">obs_sequence.ObsSequence.update_attributes_from_df()</span></code></a> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">obs_seq</span><span class="o">.</span><span class="n">update_attributes_from_df</span><span class="p">()</span>
</pre></div>
</div>
<section id="a-note-on-identity-observations">
<h3>A Note on Identity Observations<a class="headerlink" href="#a-note-on-identity-observations" title="Link to this heading">#</a></h3>
<p>Identity observations are a special type of observation, where the location and value of the observation is the
identical to the state. They are used to sample the model state directly, essentially creating “observations”
that are exact copies of certain state variables. Identity observations do not get listed in the header of
the observation sequence file, they are denoted in a given observation by a type (kind) of -x where x is
the index in the DART state vector that the observation corresponds to.</p>
<p>In the ObsSequence DataFrame, the type of identity observations is stored as this negative
integer of the index in the DART state vector.</p>
</section>
<section id="multi-component-observations">
<h3>Multi-component Observations<a class="headerlink" href="#multi-component-observations" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="statistics.html#stats-multi-comp"><span class="std std-ref">Multi-component Observations</span></a> are a observations constructed from component observations.
For example, U and V wind components can be combined into a single observation of horizontal wind speed.</p>
<p>You can create composite observations in your workflow as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pydartdiags.obs_sequence.obs_sequence</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">obsq</span>
<span class="n">obs_seq</span> <span class="o">=</span> <span class="n">obsq</span><span class="o">.</span><span class="n">ObsSequence</span><span class="p">(</span><span class="s1">&#39;obs_seq.final&#39;</span><span class="p">)</span>
<span class="n">obs_seq</span><span class="o">.</span><span class="n">composite_types</span><span class="p">()</span>
</pre></div>
</div>
<p>The default list of composite observation types is defined in
<a class="reference external" href="https://github.com/NCAR/pyDARTdiags/blob/main/src/pydartdiags/obs_sequence/composite_types.yaml">composite_types.yaml</a>
file. You can give a custom list of composite observation types by passing the path to a YAML file
to the <cite>composite_types</cite> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">obs_seq</span><span class="o">.</span><span class="n">composite_types</span><span class="p">(</span><span class="n">composite_types</span><span class="o">=</span><span class="s1">&#39;my_composite_types.yaml&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>By default, duplicate composite observations treated as distinct observations
because this is the behavior of the Fortran obs_diag code, which does not look
for nor identify duplicate observations. You can raise an exception if duplicate
composite observations are found by passing the <cite>raise_on_duplicate</cite> argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">obs_seq</span><span class="o">.</span><span class="n">composite_types</span><span class="p">(</span><span class="n">raise_on_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This will raise an exception if duplicate composite observations are found in the observation sequence.</p>
</div>
</section>
</section>
<section id="calculating-statistics">
<h2>Calculating Statistics<a class="headerlink" href="#calculating-statistics" title="Link to this heading">#</a></h2>
<p>The <a class="reference internal" href="../api/stats.html#module-0" title="stats"><code class="xref py py-mod docutils literal notranslate"><span class="pre">stats</span></code></a> module contains functions to calculate statistics on the given DataFrame.
For definitions of the statistics calculated, see the <a class="reference internal" href="statistics.html#statistics"><span class="std std-ref">Statistics</span></a> section of the user guide.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note statistics calculations only apply to data from obs_seq.final files, as they
require assimilation information from DART</p>
</div>
<p><a class="reference internal" href="../api/stats.html#stats.diag_stats" title="stats.diag_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">stats.diag_stats()</span></code></a> modifies the DataFrame in place by adding the following columns:</p>
<ul class="simple">
<li><p>‘prior_sq_err’ and ‘posterior_sq_err’: The square error for the ‘prior’ and ‘posterior’ phases.</p></li>
<li><p>‘prior_bias’ and ‘posterior_bias’: The bias for the ‘prior’ and ‘posterior’ phases.</p></li>
<li><p>‘prior_totalvar’ and ‘posterior_totalvar’: The total variance for the ‘prior’ and ‘posterior’ phases.</p></li>
</ul>
<p>You may be interested in the statistics at various vertical levels. The <a class="reference internal" href="../api/stats.html#module-0" title="stats"><code class="xref py py-mod docutils literal notranslate"><span class="pre">stats</span></code></a> module function
<a class="reference internal" href="../api/stats.html#stats.bin_by_layer" title="stats.bin_by_layer"><code class="xref py py-func docutils literal notranslate"><span class="pre">stats.bin_by_layer()</span></code></a> will add two additional columns for the binned vertical levels and
their midpoints:</p>
<ul class="simple">
<li><p>‘vlevels’: The categorized vertical levels. [bottom, top]</p></li>
<li><p>‘midpoint’: The midpoint of each vertical level bin.</p></li>
</ul>
<p>Similarly, you may want to bin the observations by time. The <a class="reference internal" href="../api/stats.html#module-0" title="stats"><code class="xref py py-mod docutils literal notranslate"><span class="pre">stats</span></code></a> module function
<a class="reference internal" href="../api/stats.html#stats.bin_by_time" title="stats.bin_by_time"><code class="xref py py-func docutils literal notranslate"><span class="pre">stats.bin_by_time()</span></code></a> will add two additional columns for the binned time and
their midpoints:</p>
<ul class="simple">
<li><p>‘time_bin’: The categorized time bins. [start, end]</p></li>
<li><p>‘time_bin_midpoint’: The midpoint of each time bin.</p></li>
</ul>
<p>A detailed description of the statistics calculated by pyDARTdiags can be found in the
<a class="reference internal" href="statistics.html#statistics"><span class="std std-ref">Statistics</span></a> section of the user guide.</p>
</section>
<section id="diagnostic-plots">
<h2>Diagnostic plots<a class="headerlink" href="#diagnostic-plots" title="Link to this heading">#</a></h2>
<p>The module <a class="reference internal" href="../api/matplots.html#module-0" title="matplots"><code class="xref py py-mod docutils literal notranslate"><span class="pre">matplots</span></code></a> contains functions to plot the observation sequence data using
<a class="reference external" href="https://matplotlib.org/">Matplotlib</a>. These functions produce plots similar to the
DART <a class="reference external" href="https://docs.dart.ucar.edu/en/latest/guide/matlab-observation-space.html">Matlab diagnostics</a>,
that is, time evolution and profiles of the statistics for a given observation type,
and rank histograms for a given observation type. The <a class="reference internal" href="../examples/03_diagnostics/index.html#diag-examples-index"><span class="std std-ref">Diagnostics</span></a> Gallery shows examples of how to use
these functions.</p>
<p>Diagnostics plots require assimilation information from DART, so they only work with obs_seq.final files.
For more general examples of visualization of observation sequences, see the the <a class="reference internal" href="../examples/02_visualizing/index.html#vis-examples-index"><span class="std std-ref">Visualizing Observation Sequences</span></a> Gallery.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="quickstart.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Quickstart</p>
      </div>
    </a>
    <a class="right-next"
       href="statistics.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Statistics</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-observation-sequence-objects">Working with Observation Sequence Objects</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-note-on-identity-observations">A Note on Identity Observations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-component-observations">Multi-component Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-statistics">Calculating Statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnostic-plots">Diagnostic plots</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, University Corporation for Atmospheric Research.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>